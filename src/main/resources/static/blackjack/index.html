<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
    <style>
        /* Reset */
        html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {

            margin:0;

            padding:0;

            border:0;

            font-size:100%;

            vertical-align:baseline;

        }

        h1{
            font-size:35px;
            text-align: center;
            line-height: 40px;
        }

        h2{
            font-size:30px;
            text-align: center;
            line-height: 40px;
        }


        p{
            font-size:20px;
            line-height: 40px;
        }

        a{
            text-decoration: none;
            color: #06C;
        }

        body{
            min-height: 100%;
            min-width: 1024px;
            width: 100%;
            height: auto;
            font-family: Arial, Helvetica, sans-serif;
            color: #333;
            font-size: 15px;
            line-height: 40px;
            background-image: url('background.jpg');
        }

        .clear{
            clear: both;
        }

        .page{
            width: auto;
            max-width: 900px;
            margin: 0 auto;
            min-height: 500px;
            text-align: center;
            font-family: "KBIZ한마음고딕 B";
            color: white;
        }

        .dealer-cards .card, .player-cards .card {
            margin-left: 5px;
        }

        .dealer-cards .card:first-child, .player-cards .card:first-child{
            margin-left: 0;
        }

        .new-cards .card:first-child{
            margin-left: 5px;
        }

        .dealer-cards, .player-cards{
            padding-top: 50px;
            /*width: 164px;*/
            margin: 0 auto;
            display: inline-block;
        }

        .dealer-total, .player-total{
            margin-top: 10px;
        }

        .buttons{
            width: 210px;
            margin: 20px auto 0 auto;
        }

        .flipped{
            background-position: -158px -492px !important;
        }


        .btn {
            font: bold 15px "Helvetica Neue", Helvetica, Arial, clean, sans-serif !important;
            text-shadow: 0 -1px 1px rgba(0,0,0,0.25), -2px 0 1px rgba(0,0,0,0.25);
            border-radius: 5px;
            -moz-border-radius: 5px;
            -webkit-border-radius: 5px;
            -moz-box-shadow: 0 1px 2px rgba(0,0,0,0.5);
            -webkit-box-shadow: 0 1px 2px rgba(0,0,0,0.5);
            display: inline-block;
            color: black;
            white-space: nowrap;
            text-decoration: none;
            cursor: pointer;
            background-color: white;
            border-style: none;
            text-align: center;
            overflow: visible;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            padding-top: 10px;
            opacity: 0.7;
            height: 40px;
            width: 100px;
            -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */
            -moz-box-sizing: border-box;    /* Firefox, other Gecko */
            box-sizing: border-box;         /* Opera/IE 8+ */
        }

        .btn:hover,
        .btn:focus {
            background-position: 0 -50px;
            color: white;
            background-color: gray;
        }

        .btn:active {
            background-color: black;
            -moz-box-shadow: inset 0 1px 2px rgba(0,0,0,0.7);
            -webkit-box-shadow: none;
        }

        .card {
            background-image: url(./cards.png);
            float: left;
            height: 123px;
            width: 79px;
        }

        .message{
            font-size: 25px;
            margin-top: 30px;
            height: 60px;
        }

        /*.dealer-total{*/
        /*visibility: hidden;*/
        /*}*/


        /* Clubs */
        .ace-of-clubs{
            background-position: 0 0;
        }

        .two-of-clubs{
            background-position: -79px 0;
        }

        .three-of-clubs{
            background-position: -158px 0;
        }

        .four-of-clubs{
            background-position: -237px 0;
        }

        .five-of-clubs{
            background-position: -316px 0;
        }

        .six-of-clubs{
            background-position: -395px 0;
        }

        .seven-of-clubs{
            background-position: -474px 0;
        }

        .eight-of-clubs{
            background-position: -553px 0;
        }

        .nine-of-clubs{
            background-position: -632px 0;
        }

        .ten-of-clubs{
            background-position: -711px 0;
        }

        .jack-of-clubs{
            background-position: -790px 0;
        }

        .queen-of-clubs{
            background-position: -869px 0;
        }

        .king-of-clubs{
            background-position: -948px 0;
        }




        /* Spades */
        .ace-of-spades{
            background-position: 0 -123px;
        }

        .two-of-spades{
            background-position: -79px -123px;
        }

        .three-of-spades{
            background-position: -158px -123px;
        }

        .four-of-spades{
            background-position: -237px -123px;
        }

        .five-of-spades{
            background-position: -316px -123px;
        }

        .six-of-spades{
            background-position: -395px -123px;
        }

        .seven-of-spades{
            background-position: -474px -123px;
        }

        .eight-of-spades{
            background-position: -553px -123px;
        }

        .nine-of-spades{
            background-position: -632px -123px;
        }

        .ten-of-spades{
            background-position: -711px -123px;
        }

        .jack-of-spades{
            background-position: -790px -123px;
        }

        .queen-of-spades{
            background-position: -869px -123px;
        }

        .king-of-spades{
            background-position: -948px -123px;
        }



        /* Hearts */
        .ace-of-hearts{
            background-position: 0 -246px;
        }

        .two-of-hearts{
            background-position: -79px -246px;
        }

        .three-of-hearts{
            background-position: -158px -246px;
        }

        .four-of-hearts{
            background-position: -237px -246px;
        }

        .five-of-hearts{
            background-position: -316px -246px;
        }

        .six-of-hearts{
            background-position: -395px -246px;
        }

        .seven-of-hearts{
            background-position: -474px -246px;
        }

        .eight-of-hearts{
            background-position: -553px -246px;
        }

        .nine-of-hearts{
            background-position: -632px -246px;
        }

        .ten-of-hearts{
            background-position: -711px -246px;
        }

        .jack-of-hearts{
            background-position: -790px -246px;
        }

        .queen-of-hearts{
            background-position: -869px -246px;
        }

        .king-of-hearts{
            background-position: -948px -246px;
        }


        /* Diamonds */
        .ace-of-diamonds{
            background-position: 0 -369px;
        }

        .two-of-diamonds{
            background-position: -79px -369px;
        }

        .three-of-diamonds{
            background-position: -158px -369px;
        }

        .four-of-diamonds{
            background-position: -237px -369px;
        }

        .five-of-diamonds{
            background-position: -316px -369px;
        }

        .six-of-diamonds{
            background-position: -395px -369px;
        }

        .seven-of-diamonds{
            background-position: -474px -369px;
        }

        .eight-of-diamonds{
            background-position: -553px -369px;
        }

        .nine-of-diamonds{
            background-position: -632px -369px;
        }

        .ten-of-diamonds{
            background-position: -711px -369px;
        }

        .jack-of-diamonds{
            background-position: -790px -369px;
        }

        .queen-of-diamonds{
            background-position: -869px -369px;
        }

        .king-of-diamonds{
            background-position: -948px -369px;
        }

        .bet{
            width: 50px;
            margin: 0 auto;
            height: 40px;
        }

        .betting-area{
            width: 70px;
            margin: 30px auto 30px auto;
        }

        .betting-area #more{
            float: left;
            width: 30px;
        }

        .betting-area #less{
            float: left;
            width: 30px;
        }

        .money{
            color: white;
            font-size: 21px;
        }
        .rank{
            float:left;
        }

        .login_img{
            margin-top:  300px;
        }

        .login_text{
            color: white;
            font-size: 30px;
            font-family: "KBIZ한마음고딕 B";
            margin-bottom: 30px;
        }

        .no_id_in_data{
            color: white;
            font-size: 30px;
            font-family: "KBIZ한마음고딕 B";
            margin-top: 300px;
        }

        .view_id_and_money{
            padding: 10px 10px 10px 10px;
            width: 300px;
            margin-top: 100px;
            background-color: white;
            color: black;
            border-radius: 5px;
            /*opacity: 0.7;*/
            margin: 30px auto 30px auto;
        }

        #myID, #myMONEY{
            background-color: lightgray;
            border-radius: 5px;
            color: black;
            padding: 2px 5px 2px 5px;
        }

        #input_login_name{
            font-family: "KBIZ한마음고딕 B";
            background-color:white;
            height: 30px;
            opacity: 0.5;
            border: none;
            font-size: 20px;
            color: black;
        }
    </style>
</head>
<body>
<div class="page" id="login">
    <div>
        <div></div>
        <div class="login_img"><img src="real_real_daemoon.png"></div>
        <div class="login_text">ID <input type="text" id="input_login_name"/></div>
        <div class="buttons"><div class="btn" id="login_button">Login</div> <div class="btn" id="signup_button">Signup</div></div>
        <!--<div class="buttons"></div>-->
    </div>
</div>
<div class="page" id="lobby" style="display: none">
    <div>
        <div class="no_id_in_data">입력과 일치하는 아이디가 없네요.<br>아래 버튼을 누르면 아이디가 생성됩니다.</div>
        <div class="buttons"><div class="btn" id="create_room_button">Create</div></div>
    </div>
</div>
<div class="page" id="game" style="display: none">
    <div class="view_id_and_money">
        <p>ID&nbsp;<span id="myID"></span> &nbsp; &nbsp; &nbsp; MONEY&nbsp;<span id="myMONEY"> </span></p><!--현재 아이디 추가-->
    </div>
    <div class="rank"> <!-- ranking 추가 -->
        <p>Ranking : </p>
    </div>
    <br>
    <div class="dealer-cards"></div>
    <div class="clear"></div>
    <div class="player-cards"></div>
    <div class="buttons">
        <div class="btn" id="hit">Hit</div>
        <div class="btn" id="stand">Stand</div>
        <div class="btn" id="doubledown">double down</div>
    </div>
    <div class="buttons"><div class="btn" id="deal">Deal</div></div>
    <div class="betting-area">
        <b>Your Bet</b><br>
        <div id="bet" class="bet money">0</div>
        <div>
            <div class="btn" id="more">+</div>
            <div class="btn" id="less">-</div>
        </div>
        <div class="clear"></div>
    </div>
    <div>
        <b>Available Funds</b><br>
        <span id="money" class="money"></span>
        <div class="clear"></div>
    </div>
</div>
</body>
<script src="./jquery-3.3.1.min.js"></script>

<script>
    var user;
    var gameRoomId;

    $('#login_button').click(function() {
        var loginName = $('#input_login_name').val();
        if(loginName == "") {
            alert("이름을 입력해주세요.");
        }
        $.ajax({
            type: 'POST',
            url: 'http://localhost:8080/api/black-jack/login',
            data: loginName,
            contentType:'application/json;'
        }).done(function(data) {
            $('#login').hide();
            $('#lobby').show();
            user = data;
        });
    });

    $('#signup_button').click(function() {
        var loginName = $('#input_login_name').val();
        if(loginName == "") {
            alert("이름을 입력해주세요.");
        }
        $.ajax({
            type: 'POST',
            url: 'http://localhost:8080/api/black-jack/users',
            data: loginName,
            contentType:'application/json;'
        }).done(function(data) {
            $('#login').hide();
            $('#lobby').show();
            user = data;
        });
    });

    $('#create_room_button').click(function() {
        $.ajax({
            type: 'POST',
            url: 'http://localhost:8080/api/black-jack/rooms',
            headers: {
                'name':user.name
            }
        }).done(function(data) {
            $('#login').hide();
            $('#lobby').hide();
            $('#game').show();
            gameRoomId = data.roomId;
            drawGameRoom(data);
            //상단에 나의 아이디 보이게 함
            document.getElementById('myID').innerHTML= document.getElementById('input_login_name').value;
        });
    })

    $('#deal').click(function() {
        var bet = parseInt($('#bet').html());

        if(bet == 0){ // betting금액이 0이면 경고창 띄워 알려주기
            alert("0보다 큰 금액을 betting 해야 됩니다.");
        }
        $.ajax({
            type: 'POST',
            url: 'http://localhost:8080/api/black-jack/rooms/' + gameRoomId + '/bet',
            headers: {
                'name':user.name
            },
            data: JSON.stringify(bet),
            contentType:'application/json;',
        }).done(function(data) {
            drawGameRoom(data);
        });

        if(bet > 10000){ // betting금액이 10000이면 경고창 띄워 알려주기
            alert("10000보다 작은 금액을 betting 해야 됩니다.");
        }
        $.ajax({
            type: 'POST',
            url: 'http://localhost:8080/api/black-jack/rooms/' + gameRoomId + '/bet',
            headers: {
                'name':user.name
            },
            data: JSON.stringify(bet),
            contentType:'application/json;',
        }).done(function(data) {
            drawGameRoom(data);
        });
    })

    $('#hit').click(function() {
        $.ajax({
            type: 'POST',
            url: 'http://localhost:8080/api/black-jack/rooms/' + gameRoomId + '/hit',
            headers: {
                'name':user.name
            },
        }).done(function(data) {
            drawGameRoom(data);
        });
    })

    $('#stand').click(function() {
        $.ajax({
            type: 'POST',
            url: 'http://localhost:8080/api/black-jack/rooms/' + gameRoomId + '/stand',
            headers: {
                'name':user.name
            },
        }).done(function(data) {
            drawGameRoom(data);
        });
    })

    $('#doubledown').click(function(){
        $.ajax({
            type: 'POST',
            url: 'http://localhost:8080/api/black-jack/rooms/' + gameRoomId + '/hit',
            headers: {
                'name':user.name
            },
        }).done(function(data) {
            drawGameRoom(data);
            $('#hit').hide();
            $('#stand').hide();
            $('#deal').show();
            $('#doubledown').hide();
            var currentBet = parseInt($('#bet').html());
            var money = parseInt($('#money').html());
            if(data.playerList[user.name].hand.cardSum < 21 && data.dealer.hand.cardSum < 21){
                if(data.dealer.hand.cardSum < data.playerList[user.name].hand.cardSum){
                    console.log('dealer<21 player < 21 plus');
                    money += (2 * currentBet);
                }
                else{
                    console.log('dealer<21 player < 21 minus');
                    money -= (2 * currentBet);
                }
            }
            else if(data.dealer.hand.cardSum > 21 && data.playerList[user.name].hand.cardSum < 21){
                console.log('dealer > 21 player < 21 plus');
                money += (2 * currentBet);
            }
            else if(data.dealer.hand.cardSum < 21 && data.playerList[user.name].hand.cardSum > 21){
                console.log('dealer < 21 player > 21 minus');
                money -= (2 * currentBet);
            }
            data.finished = true;
            drawGameRoom(data);
        });
    })

    $('#more').click(function(){
        var bet = 1000;//180610
        var currentBet = parseInt($('#bet').html());
        var money = parseInt($('#money').html());
        if (money < bet) {
            bet = money;//베팅금액이 현재 돈보다 많을경우 전재산으로 함
        }

        $('#bet').html(currentBet + bet);
        $('#money').html(money - bet);
        //현재 내 돈 추가
        $('#myMONEY').html(money - bet);
    });

    $('#less').click(function(){
        var bet = 1000;//180610
        var currentBet = parseInt($('#bet').html());
        var money = parseInt($('#money').html());
        if(currentBet < bet) {
            bet = currentBet;
        }

        $('#bet').html(currentBet - bet);
        $('#money').html(money + bet);
        //현재 내 돈 추가
        $('#myMONEY').html(money - bet);
    });

    function drawGameRoom(gameRoom) {
        console.log(gameRoom);
        console.log(gameRoom.finished);
        if (gameRoom.finished) {
            $('#deal').show();
            $('#more').show();
            $('#less').show();
            $('#hit').hide();
            $('#stand').hide();
            $('#doubledown').hide();

        } else {
            $('#deal').hide();
            $('#more').hide();
            $('#less').hide();
            $('#hit').show();
            $('#stand').show();
            $('#doubledown').show();
        }

        $('.dealer-cards').html("");
        gameRoom.dealer.hand.cardList.forEach(function(card) {
            $('.dealer-cards').append(generateCardDiv(card.rank, card.suit));
        })
        if (gameRoom.dealer.hand.cardList.length == 1) {
            $('.dealer-cards').append('<div class="card card2 flipped" data-value="6"></div>');
        }
        if (gameRoom.dealer.hand.cardList.length > 0) {
            $('.dealer-cards').append('<div id="dealerTotal" class="dealer-total">' + gameRoom.dealer.hand.cardSum + '</div>');
        }

        $('.player-cards').html("");
        gameRoom.playerList[user.name].hand.cardList.forEach(function(card) {
            $('.player-cards').append(generateCardDiv(card.rank, card.suit));
        });
        if (gameRoom.playerList[user.name].hand.cardList.length > 0) {
            $('.player-cards').append('<div id="playerTotal" class="player-total">' + gameRoom.playerList[user.name].hand.cardSum + '</div>');
        }

        $('#bet').html(gameRoom.playerList[user.name].currentBet);
        $('#money').html(gameRoom.playerList[user.name].balance);
        //현재 내 돈 추가
        $('#myMONEY').html(gameRoom.playerList[user.name].balance);
    }

    function generateCardDiv(rank, suit) {
        var className = "";
        switch (rank) {
            case 1 :
                className = "ace-of-";
                break;
            case 2:
                className = "two-of-";
                break;
            case 3 :
                className = "three-of-";
                break;
            case 4 :
                className = "four-of-";
                break;
            case 5 :
                className = "five-of-";
                break;
            case 6 :
                className = "six-of-";
                break;
            case 7 :
                className = "seven-of-";
                break;
            case 8 :
                className = "eight-of-";
                break;
            case 9 :
                className = "nine-of-";
                break;
            case 10 :
                className = "ten-of-";
                break;
            case 11 :
                className = "jack-of-";
                break;
            case 12 :
                className = "queen-of-";
                break;
            case 13 :
                className = "king-of-";
                break;
        }
        className += suit.toLowerCase();

        return "<div class='card " + className + "' data-value='" + rank +"'></div>";
    }
</script>

</html>
